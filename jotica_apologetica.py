#!/usr/bin/env python3
"""
üôè Jotica Bible - Simulador Avanzado
Versi√≥n que funciona sin modelo entrenado, incluyendo apolog√©tica cristiana
con fundamentos hist√≥ricos s√≥lidos para responder a ateos y esc√©pticos
"""

import re
import random
import json
from pathlib import Path

class JoticaApologetica:
    def __init__(self):
        """Inicializar Jotica con respuestas b√≠blicas y apolog√©ticas"""
        
        # Cargar dataset apolog√©tico si existe
        self.respuestas_apologeticas = self.cargar_dataset_apologetico()
        
        self.respuestas_biblicas = {
            # Patrones apolog√©ticos y de objeciones
            r'jesus no exist|jesus es mito|jesus nunca exist|mito de jesus': [
                "Comprendo tu inquietud, y es una pregunta leg√≠tima que merece una respuesta fundamentada. La evidencia hist√≥rica sobre la existencia de Jes√∫s es abrumadora, incluso entre historiadores no cristianos.\n\nTenemos fuentes hist√≥ricas no cristianas: Flavio Josefo menciona a Jes√∫s dos veces, T√°cito escribe sobre 'Cristo', Plinio el Joven describe las pr√°cticas cristianas. Los manuscritos del Nuevo Testamento son los m√°s numerosos de la antig√ºedad - m√°s de 5,800 manuscritos griegos.\n\nIncluso historiadores ateos como Bart Ehrman afirma: 'Jes√∫s existi√≥, y los eruditos serios est√°n de acuerdo en esto'. ¬øTe gustar√≠a profundizar en alguna evidencia espec√≠fica?"
            ],
            
            r'biblia no es confiable|biblia escrita despues|manuscritos biblicos': [
                "La evidencia textual de la Biblia es extraordinaria. Los evangelios fueron escritos entre 50-90 d.C., apenas 20-60 a√±os despu√©s de los eventos. Tenemos el fragmento P52 de Juan del 125 d.C., solo 25-30 a√±os despu√©s de ser escrito.\n\nLos Rollos del Mar Muerto muestran que el texto de Isa√≠as es 95% id√©ntico despu√©s de 1,000 a√±os. Los eruditos como F.F. Bruce confirman que tenemos mejor evidencia manuscrita para el NT que para cualquier libro de la antig√ºedad.\n\n¬øQu√© aspecto espec√≠fico de la confiabilidad hist√≥rica te interesa m√°s?"
            ],
            
            r'no hay evidencia arqueologica|arqueologia biblia': [
                "La arqueolog√≠a ha confirmado extraordinariamente la exactitud b√≠blica. La Estela de Merneptah menciona 'Israel' en 1230 a.C., la Inscripci√≥n de Pilato confirma su t√≠tulo exacto, los osarios de Caif√°s confirman al sumo sacerdote que juzg√≥ a Jes√∫s.\n\nLa piscina de Betesda fue descubierta exactamente como Juan la describe. William Albright declar√≥: 'La arqueolog√≠a ha confirmado la sustancial historicidad de la tradici√≥n del Antiguo Testamento.' ¬øTe interesa alg√∫n descubrimiento espec√≠fico?"
            ],
            
            r'contradicciones biblia|errores biblia': [
                "Las aparentes contradicciones se resuelven con estudio del contexto y cultura antigua. Los evangelios son como cuatro testigos - cada uno ve desde su perspectiva. Las genealog√≠as de Jes√∫s siguen l√≠neas diferentes: una legal (Jos√©), otra de sangre (Mar√≠a).\n\nGleason Archer, tras 60 a√±os de estudio: 'No he encontrado una sola contradicci√≥n genuina que no pueda resolverse.' John Haley document√≥ m√°s de 900 'contradicciones' aparentes con soluciones razonables. ¬øHay alguna contradicci√≥n espec√≠fica que te inquieta?"
            ],
            
            r'cristianismo copia religion|mitra|horus|religion pagana': [
                "Esta objeci√≥n no resiste el escrutinio acad√©mico. Muchas supuestas 'fuentes' fueron escritas DESPU√âS del cristianismo. El mitra√≠smo alcanz√≥ prominencia en el siglo II d.C., DESPU√âS del cristianismo.\n\nJonathan Z. Smith (Universidad de Chicago): 'Los paralelos han sido enormemente exagerados.' El cristianismo surgi√≥ del juda√≠smo con conceptos √∫nicos como resurrecci√≥n corporal y monote√≠smo √©tico - ajenos a religiones mist√©ricas. ¬øTe gustar√≠a examinar alguna religi√≥n espec√≠fica?"
            ],
            
            r'ciencia refuta dios|ciencia vs religion|evolucion': [
                "Muchos cient√≠ficos prominentes son creyentes: Francis Collins (Genoma Humano), John Polkinghorne (f√≠sico cu√°ntico). El ajuste fino del universo sugiere dise√±o - Paul Davies: 'La impresi√≥n de dise√±o es abrumadora.'\n\nEl Big Bang concuerda con 'En el principio cre√≥ Dios'. La ciencia describe el 'c√≥mo', no necesariamente el 'por qu√©' √∫ltimo. Einstein: 'La ciencia sin religi√≥n es coja, la religi√≥n sin ciencia es ciega.' ¬øHay alg√∫n aspecto cient√≠fico espec√≠fico que te genera dudas?"
            ],
            
            r'problema del mal|sufrimiento|dios bueno pero sufrimient': [
                "Es la pregunta m√°s profunda. Jes√∫s mismo llor√≥ ante el dolor (Juan 11:35). Consideraciones importantes: el libre albedr√≠o requiere libertad para elegir el mal; un mundo con leyes consistentes permite ciencia pero tambi√©n terremotos.\n\nEn Cristo, Dios entr√≥ en nuestro dolor. Corrie ten Boom: 'No hay abismo tan profundo que el amor de Dios no sea m√°s profundo.' Apocalipsis 21:4 promete un d√≠a sin dolor. ¬øHas experimentado sufrimiento que te hace cuestionar a Dios?"
            ],
            
            r'muchas religiones|solo cristianismo verdader': [
                "La existencia de billetes falsos no niega billetes aut√©nticos. El cristianismo es √∫nico: hist√≥ricamente verificable, salvaci√≥n por gracia (no obras), Dios que desciende al humano (no humano que asciende a dios).\n\nTodas las culturas buscan lo trascendente, sugiriendo fuimos creados con 'vac√≠o con forma de Dios' (Pascal). Cristo es √∫nico: 'el camino, la verdad y la vida' (Juan 14:6). ¬øHas explorado otras religiones?"
            ],
            
            r'cristianos hipocrita|da√±o christian|cruzadas|inquisicion': [
                "Reconozco honestamente las fallas hist√≥ricas: Cruzadas, Inquisici√≥n, abusos. Debemos distinguir entre Jes√∫s (perfecto) y seguidores (imperfectos). Jes√∫s denunci√≥ la hipocres√≠a religiosa m√°s duramente que nadie.\n\nPero cristianos tambi√©n abolieron esclavitud, fundaron hospitales/universidades, lucharon por derechos civiles. La hipocres√≠a confirma est√°ndares morales. Gandhi: 'Me gusta tu Cristo, no me gustan tus cristianos.' ¬øHas sido lastimado por cristianos hip√≥critas?"
            ],
            
            r'resurreccion imposible|muertos no resucitan': [
                "La pregunta no es si es 'normal', sino si ocurri√≥. Hechos aceptados por historiadores: Jes√∫s muri√≥ crucificado, tumba vac√≠a, disc√≠pulos afirmaron verlo resucitado, transformaci√≥n radical de cobardes a valientes.\n\nTeor√≠√°s alternativas fallan: ¬ødisc√≠pulos cobardes vencieron guardias romanos? ¬øJes√∫s medio muerto convenci√≥ que venci√≥ la muerte? N.T. Wright: 'La resurrecci√≥n es la mejor explicaci√≥n hist√≥rica disponible.' ¬øQu√© teor√≠a alternativa te parece m√°s plausible?"
            ],

            # Patrones sobre personajes b√≠blicos
            r'quien es moises|moises|mois√©s': [
                "Mois√©s fue uno de los grandes l√≠deres de Israel, escogido por Dios para liberar a Su pueblo de la esclavitud en Egipto. En √âxodo 3, Dios le habl√≥ desde una zarza ardiente y lo llam√≥ para esta gran misi√≥n. Mois√©s recibi√≥ los Diez Mandamientos en el Monte Sina√≠ y gui√≥ al pueblo por 40 a√±os en el desierto. Fue profeta, legislador y libertador. ¬øTe gustar√≠a conocer m√°s sobre alg√∫n episodio espec√≠fico de su vida?",
                
                "Mois√©s es considerado el gran legislador de Israel. Dios lo us√≥ para dar la Ley al pueblo hebreo. En Deuteronomio 34:10 dice: 'Nunca m√°s se levant√≥ profeta en Israel como Mois√©s, a quien haya conocido Jehov√° cara a cara.' Su vida nos ense√±a sobre la obediencia a Dios a√∫n cuando nos sintamos inadecuados. ¬øHay alguna √°rea donde sientes que Dios te est√° llamando pero te sientes insuficiente?"
            ],
            
            r'quien es jesus|jesus|jes√∫s|cristo|jesucristo': [
                "Jes√∫s es el Hijo de Dios, nuestro Salvador y Redentor. Juan 1:1 y 14 nos dice que 'En el principio era el Verbo... y aquel Verbo fue hecho carne.' Jes√∫s es completamente Dios y completamente hombre, quien vino a la tierra para salvarnos de nuestros pecados. En Juan 14:6 √âl mismo dice: 'Yo soy el camino, la verdad y la vida; nadie viene al Padre sino por m√≠.' ¬øHas experimentado personalmente el amor y la salvaci√≥n que Jes√∫s ofrece?",
                
                "Jes√∫s de Nazaret es el centro de la fe cristiana. Naci√≥ de la virgen Mar√≠a, vivi√≥ una vida sin pecado, muri√≥ en la cruz por nuestros pecados y resucit√≥ al tercer d√≠a. Filipenses 2:6-11 describe c√≥mo, siendo Dios, se humill√≥ hasta la muerte de cruz para salvarnos. Su nombre significa 'Jehov√° salva'. ¬øQu√© significa Jes√∫s para ti en tu vida personal?",
                
                "Cristo Jes√∫s es nuestro Emanuel, 'Dios con nosotros' (Mateo 1:23). √âl vino no solo para darnos vida eterna, sino vida abundante (Juan 10:10). Es el Buen Pastor que da Su vida por las ovejas, el Pan de Vida, la Luz del mundo. En Hebreos 4:15 vemos que puede compadecerse de nuestras debilidades porque fue tentado en todo seg√∫n nuestra semejanza, pero sin pecado. ¬øTe consuela saber que Jes√∫s comprende perfectamente tus luchas?"
            ],
            
            r'quien es david|david|rey david': [
                "David fue el segundo rey de Israel y es conocido como 'un var√≥n conforme al coraz√≥n de Dios' (1 Samuel 13:14). Comenz√≥ como un joven pastor que venci√≥ al gigante Goliat con fe en Dios. Escribi√≥ muchos de los Salmos que leemos hoy. Su vida nos ense√±a sobre la adoraci√≥n, el arrepentimiento genuino (como en el Salmo 51) y la confianza en Dios en tiempos dif√≠ciles. ¬øConoces alg√∫n Salmo de David que te haya consolado?",
                
                "El rey David es uno de los personajes m√°s humanos de la Biblia. Tuvo grandes victorias pero tambi√©n cometi√≥ errores serios. Su historia nos ense√±a que Dios puede usar personas imperfectas para Sus prop√≥sitos. En el Salmo 23, David nos da una de las declaraciones de fe m√°s hermosas: 'Jehov√° es mi pastor; nada me faltar√°.' ¬øHay alguna situaci√≥n donde necesitas recordar que Dios es tu pastor?"
            ],

            # Patrones sobre amor
            r'amor|amar|amo': [
                "El amor es el tema central de la Biblia. En 1 Corintios 13:4-7, Pablo nos ense√±a que el amor es sufrido, es benigno; el amor no tiene envidia, el amor no es jactancioso, no se envanece. ¬øHas experimentado este tipo de amor incondicional?",
                
                "Jes√∫s dijo en Juan 13:34-35: 'Un mandamiento nuevo os doy: Que os am√©is unos a otros; como yo os he amado.' El amor cristiano no es solo un sentimiento, sino una decisi√≥n de servir y bendecir a otros. ¬øC√≥mo puedes mostrar amor hoy?",
                
                "1 Juan 4:8 nos recuerda que 'Dios es amor'. Todo amor verdadero viene de √âl. Cuando amamos a otros, reflejamos Su car√°cter divino. ¬øTe has preguntado c√≥mo Dios te ama incondicionalmente?"
            ],
            
            # Patrones sobre paz
            r'paz|tranquil|calm|ansie|preocup|estres': [
                "La paz que Jes√∫s da es diferente a la paz del mundo. En Juan 14:27 dice: 'La paz os dejo, mi paz os doy; yo no os la doy como el mundo la da.' Su paz permanece a√∫n en medio de las tormentas. ¬øHas experimentado esta paz sobrenatural?",
                
                "Filipenses 4:6-7 es un vers√≠culo hermoso: 'Por nada est√©is afanosos, sino sean conocidas vuestras peticiones delante de Dios en toda oraci√≥n... Y la paz de Dios... guardar√° vuestros corazones y pensamientos.' ¬øHas probado entregar tus preocupaciones a Dios en oraci√≥n?",
                
                "Isa√≠as 26:3 promete: 'T√∫ guardar√°s en completa paz a aquel cuyo pensamiento en ti persevera.' La paz viene de mantener nuestra mente fija en Dios. ¬øQu√© pensamientos ocupan m√°s tiempo en tu mente durante el d√≠a?"
            ],
            
            # Patrones sobre oraci√≥n
            r'orar|oracion|rezo|pleg': [
                "La oraci√≥n es simplemente hablar con Dios como con un amigo. Jes√∫s nos ense√±√≥ el Padre Nuestro en Mateo 6:9-13 como modelo. No necesitas palabras perfectas, solo un coraz√≥n sincero. ¬øTe resulta dif√≠cil encontrar palabras para orar?",
                
                "1 Tesalonicenses 5:17 nos anima a 'orar sin cesar'. Esto no significa estar arrodillados todo el d√≠a, sino mantener una actitud de comuni√≥n constante con Dios. ¬øHas probado hacer oraciones cortas durante el d√≠a?",
                
                "Santiago 5:16 dice que 'la oraci√≥n eficaz del justo puede mucho'. Dios escucha nuestras oraciones y act√∫a. A veces Su respuesta es 's√≠', a veces 'no', y a veces 'espera'. ¬øHas visto respuestas a tus oraciones?"
            ],
            
            # Patrones sobre perd√≥n
            r'perdon|perdona|rencor|vengan|odio': [
                "El perd√≥n es uno de los aspectos m√°s liberadores del cristianismo. Efesios 4:32 nos dice: 'Sed benignos unos con otros, misericordiosos, perdon√°ndoos unos a otros, como Dios tambi√©n os perdon√≥.' Perdonar no significa que el dolor no existi√≥, sino que elegimos liberar la amargura. ¬øHay alguien a quien necesitas perdonar?",
                
                "Mateo 18:21-22 cuenta cuando Pedro pregunt√≥ si deb√≠a perdonar siete veces, y Jes√∫s respondi√≥ 'setenta veces siete'. El perd√≥n no tiene l√≠mites cuando seguimos el ejemplo de Cristo. ¬øTe resulta dif√≠cil perdonar a alguien en particular?",
                
                "El perd√≥n es un regalo que nos damos a nosotros mismos. Como dijo Nelson Mandela: 'El resentimiento es como beber veneno esperando que muera el otro.' Dios quiere liberarte de esa carga. ¬øEstar√≠as dispuesto a pedirle ayuda para perdonar?"
            ]
        }
        
        self.respuestas_generales = [
            "Esa es una pregunta muy profunda que merece una respuesta b√≠blica fundamentada. Las Escrituras tienen mucha sabidur√≠a sobre este tema, y la historia confirma su veracidad. ¬øTe gustar√≠a que exploremos juntos qu√© dice la Palabra de Dios al respecto?",
            
            "Me alegra que busques respuestas s√≥lidas. Proverbios 3:5-6 nos anima a confiar en Jehov√° de todo coraz√≥n. La arqueolog√≠a y la historia han confirmado la confiabilidad de las Escrituras una y otra vez. ¬øHas llevado esta inquietud a Dios en oraci√≥n?",
            
            "Es hermoso ver tu coraz√≥n buscador de la verdad. Jes√∫s dijo en Juan 8:32: 'Conocer√©is la verdad, y la verdad os har√° libres.' Dios honra a quienes buscan Sus caminos con sinceridad y mente abierta."
        ]
        
        self.saludos = [
            "¬°Hola! Soy Jotica, tu compa√±era en la b√∫squeda de la verdad. Me alegra poder conversar contigo sobre la fe cristiana con fundamentos hist√≥ricos s√≥lidos.",
            "¬°Bendiciones! Es un gozo poder explorar contigo las evidencias hist√≥ricas y arqueol√≥gicas que confirman la veracidad de las Escrituras.",
            "¬°Paz y gracia! Estoy aqu√≠ para examinar juntos las evidencias que respaldan la fe cristiana con rigor intelectual."
        ]

    def cargar_dataset_apologetico(self):
        """Cargar dataset apolog√©tico desde archivo JSON si existe"""
        try:
            path = Path("data/processed/jotica_apologetica.json")
            if path.exists():
                with open(path, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    print(f"üìö Dataset apolog√©tico cargado: {len(data)} respuestas especializadas")
                    return data
        except Exception as e:
            print(f"‚ö†Ô∏è No se pudo cargar dataset apolog√©tico: {e}")
        return []

    def buscar_respuesta_especializada(self, mensaje: str) -> str:
        """Buscar respuesta especializada en el dataset apolog√©tico"""
        if not self.respuestas_apologeticas:
            return None
            
        mensaje_lower = mensaje.lower()
        
        # Palabras clave apolog√©ticas
        keywords_map = {
            'existencia de jesus': ['jesus no exist', 'mito', 'nunca exist'],
            'confiabilidad biblia': ['biblia', 'manuscritos', 'confiable', 'escrita'],
            'arqueologia': ['arqueolog', 'evidencia', 'excavacion'],
            'contradicciones': ['contradicci', 'error', 'inconsisten'],
            'religiones paganas': ['copia', 'mitra', 'horus', 'pagana'],
            'ciencia': ['ciencia', 'evolucion', 'big bang', 'refuta'],
            'problema mal': ['sufrimiento', 'mal', 'dolor', 'bueno'],
            'muchas religiones': ['religiones', 'verdadero', 'solo cristian'],
            'cristianos hipocritas': ['hipocrita', 'da√±o', 'cruzadas', 'malo'],
            'resurreccion': ['resurreccion', 'muertos', 'imposible']
        }
        
        for item in self.respuestas_apologeticas:
            instruction_lower = item['instruction'].lower()
            for keyword_list in keywords_map.values():
                if any(keyword in mensaje_lower for keyword in keyword_list):
                    if any(keyword in instruction_lower for keyword in keyword_list):
                        return item['output']
        
        return None
        
    def detectar_patron(self, mensaje: str) -> str:
        """Detectar patrones en el mensaje del usuario con mayor precisi√≥n"""
        mensaje_lower = mensaje.lower()
        
        # Primero buscar respuesta especializada apolog√©tica
        respuesta_especializada = self.buscar_respuesta_especializada(mensaje)
        if respuesta_especializada:
            return respuesta_especializada
        
        # Limpiar signos de puntuaci√≥n para mejor detecci√≥n
        mensaje_clean = re.sub(r'[¬ø?¬°!.,;:]', '', mensaje_lower)
        
        # Buscar patrones espec√≠ficos (m√°s espec√≠ficos tienen prioridad)
        for patron, respuestas in self.respuestas_biblicas.items():
            if re.search(patron, mensaje_clean):
                return random.choice(respuestas)
        
        # Si no encuentra patr√≥n espec√≠fico, dar respuesta general
        return random.choice(self.respuestas_generales)
    
    def es_saludo(self, mensaje: str) -> bool:
        """Detectar si es un saludo"""
        saludos = ['hola', 'buenos', 'buenas', 'hey', 'hi', 'hello', 'bendiciones']
        return any(saludo in mensaje.lower() for saludo in saludos)
    
    def responder(self, mensaje: str) -> str:
        """Generar respuesta apropiada con fundamento apolog√©tico"""
        if self.es_saludo(mensaje):
            return random.choice(self.saludos)
        
        return self.detectar_patron(mensaje)
    
    def conversacion_interactiva(self):
        """Modo conversaci√≥n interactiva con apolog√©tica"""
        print("üôè ¬°Bienvenido! Soy Jotica, tu asistente b√≠blico con fundamentos hist√≥ricos.")
        print("üí≠ Puedo responder preguntas sobre fe, objeciones ateas, evidencias arqueol√≥gicas...")
        print("üîç Tengo respuestas fundamentadas para esc√©pticos y buscadores de la verdad.")
        print("‚ú® Escribe 'salir' para terminar.\n")
        
        while True:
            try:
                mensaje = input("üë§ T√∫: ").strip()
                
                if not mensaje:
                    continue
                    
                if mensaje.lower() in ['salir', 'exit', 'quit', 'adi√≥s', 'adios']:
                    print("üôè ¬°Que Dios te bendiga grandemente! Espero que nuestra conversaci√≥n te haya dado fundamentos s√≥lidos para tu fe.")
                    break
                
                print("ü§î Jotica est√° analizando las evidencias...")
                respuesta = self.responder(mensaje)
                print(f"üôè Jotica: {respuesta}\n")
                
            except KeyboardInterrupt:
                print("\n\nüôè ¬°Que tengas un d√≠a lleno de bendiciones y certeza en la verdad!")
                break
            except Exception as e:
                print(f"‚ùå Error inesperado: {e}")
                print("üí° Por favor, int√©ntalo de nuevo.")

def demo_jotica_apologetica():
    """Demostraci√≥n de Jotica con capacidades apolog√©ticas"""
    print("üôè === Demo de Jotica Bible Apolog√©tica ===")
    print("ü§ñ Versi√≥n: Simulador con Fundamentos Hist√≥ricos")
    print("üîç Especializada en responder objeciones ateas")
    print("=" * 50)
    print()
    
    jotica = JoticaApologetica()
    
    preguntas_demo = [
        "Hola Jotica, soy esc√©ptico sobre el cristianismo",
        "Un amigo ateo dice que Jes√∫s nunca existi√≥",
        "¬øHay evidencia arqueol√≥gica que respalde la Biblia?",
        "Me dicen que hay muchas contradicciones en la Biblia",
        "¬øNo es el cristianismo solo una copia de religiones paganas?",
        "Si Dios es bueno, ¬øpor qu√© permite tanto sufrimiento?",
        "¬øC√≥mo puedo saber que la resurrecci√≥n realmente ocurri√≥?"
    ]
    
    for i, pregunta in enumerate(preguntas_demo, 1):
        print(f"üìù Ejemplo {i}:")
        print(f"üë§ Esc√©ptico: {pregunta}")
        respuesta = jotica.responder(pregunta)
        # Mostrar solo los primeros 300 caracteres para el demo
        respuesta_corta = respuesta[:300] + "..." if len(respuesta) > 300 else respuesta
        print(f"üôè Jotica: {respuesta_corta}")
        print("-" * 70)
        print()

if __name__ == "__main__":
    print("üôè Jotica Bible - Simulador Apolog√©tico")
    print("=" * 50)
    print("‚ÑπÔ∏è  Versi√≥n especializada en apolog√©tica cristiana")
    print("üîç Respuestas fundamentadas para esc√©pticos y ateos")
    print("üìö Incluye evidencias hist√≥ricas y arqueol√≥gicas")
    print()
    
    while True:
        print("Opciones:")
        print("1. üéÆ Ver demostraci√≥n apolog√©tica")
        print("2. üí¨ Conversaci√≥n interactiva")
        print("3. üö™ Salir")
        print()
        
        try:
            opcion = input("Elige una opci√≥n (1-3): ").strip()
            
            if opcion == '1':
                demo_jotica_apologetica()
            elif opcion == '2':
                jotica = JoticaApologetica()
                jotica.conversacion_interactiva()
            elif opcion == '3':
                print("üôè ¬°Que Dios te bendiga! La verdad siempre prevalece.")
                break
            else:
                print("‚ùå Opci√≥n no v√°lida. Por favor, elige 1, 2 o 3.")
                
        except KeyboardInterrupt:
            print("\n\nüôè ¬°Bendiciones! Que la verdad de Cristo sea tu fundamento.")
            break